import type {WebEngineAPI} from "sprig/web";
import {drawScreen} from "game/graphics/helper.ts";
import Screen from "game/graphics/Screen"

const LOOP_DELAY_MS: number = 50
const SCREEN_WIDTH = 160
const SCREEN_HEIGHT = 128

export function start(api: WebEngineAPI) {
    const {
        setLegend,
        bitmap,
        map,
        setBackground,
        setMap,
        onInput,
        getFirst,
        afterInput
    } = api
    console.log("starting")
    const screen = new Screen(SCREEN_WIDTH, SCREEN_HEIGHT)
    screen.setPixelsAt(0, 0, `7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777CCCC7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
777777777777777777777777777777CCCCCCCC77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777CCCCCCCCCC7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777CCCCCCCCCCCC777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777CCCCCCCCCCCC777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
777777777777777777777777777CCCCCCCCCCCCCC77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
777777777777777777777777777CCCCCCCCCCCCCC77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
777777777777777777777777777CCCCCCCCCCCCCCC7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
777777777777777777777777777CCCCCCCCCCCCCCC777777777777777777777777777CCCC777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
777777777777777777777777777CCCCCCCCCCCCCCC7777777777777777777777777CCCCCCCC7777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777CCCCCCCCCCCCCC777777777777777777777777CCCCCCCCCC777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777CCCCCCCCCCCCCC77777777777777777777777CCCCCCCCCCCC77777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777CCCCCCCCCCCCCCC7777777777777777777777CCCCCCCCCCCCC7777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777CCCCCCCCCCCCCCC777777777777777777777CCCCCCCCCCCCCC7777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777CCCCCCCCCCCCCCC777777777777777777777CCCCCCCCCCCCCCC777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777CCCCCCCCCCCCCC777777777777777777777CCCCCCCCCCCCCCC777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777CCCCCCCCCCCCCC777777777777777777777CCCCCCCCCCCCCCC777777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777CCCCCCCCCCCCCC777777777777777777777CCCCCCCCCCCCCCCC77777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777CCCCCCCCCCCCCC777777777777777777777CCCCCCCCCCCCCCCC77777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777CCCCCCCCCCCCCCC77777777777777777777CCCCCCCCCCCCCCCC77777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777CCCCCCCCCCCCCCC77777777777777777777CCCCCCCCCCCCCCCCC7777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777CCCCCCCCCCCCCCC7777777777777777777CCCCCCCCCCCCCCCCCC7777777777777777777777777777777777777777777777777777777777777777777777777777777
777777777777777777777777777777CCCCCCCCCCCCCCC777777777777777777CCCCCCCCCCCCCCCCCC7777777777777777777777777777777777777777777777777777777777777777777777777777777
777777777777777777777777777777CCCCCCCCCCCCCCCC7777777777777777CCCCCCCCCCCCCCCCCCC7777777777777777777777777777777777777777777777777777777777777777777777777777777
777777777777777777777777777777CCCCCCCCCCCCCCCC7777777777777777CCCCCCCCCCCCCCCCCCCC777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777CCCCCCCCCCCCCCCCC7777777777777CCCCCCCCCCCCCCCCCCCCC777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777CCCCCCCCCCCCCCCCCC777777777777CCCCCCCCCCCCCCCCCCCCC777777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777CCCCCCCCCCCCCCCCCC7777777777CCCCCCCCCCCCCCCCCCCCCCC77777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777CCCCCCCCCCCCCCCCCCC77777777CCCCCCCCCCCCCCCCCCCCCCCC77777777777777777777777777777777777777777777777777777777777777777777777777777
777777777777777777777777777777777CCCCCCCCCCCCCCCCCCCCC7777CCCCCCCCCCCCCCCCCCCCCCCCC77777777777777777777777777777777777777777777777777777777777777777777777777777
777777777777777777777777777777777CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC77777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC77777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC7777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC7777777777777777777777777777777777777777777777777777777777777777777777777777
777777777777777777777777777777777777CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC7777777777777777777777777777777777777777777777777777777777777777777777777777
77777777777777777777777777777777777777CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC77777777777777777777777777777777777777777CCCC777777777777777777777777777777
777777777777777777777777777777777777777CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC777777777777777777777777777777777777777CCCCCCCC7777777777777777777777777777
7777777777777777777777777777777777777777CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC7777777777777777777777777777777777777CCCCCCCCCC777777777777777777777777777
777777777777777777777777777777777777777777CCCCCCCCCCCCCCCCCCCCCCCCCCC7CCCCCCCCCCCCCCCC777777777777777777777777777777777777CCCCCCCCCCCC77777777777777777777777777
7777777777777777777777777777777777777777777CCCCCCCCCCCCCCCCCCCCCCCCC777CCCCCCCCCCCCCCCC77777777777777777777777777777777777CCCCCCCCCCCC77777777777777777777777777
77777777777777777777777777777777777777777777CCCCCCCCCCCCCCCCCCCCCCC7777CCCCCCCCCCCCCCCC7777777777777777777777777777777777CCCCCCCCCCCCCC7777777777777777777777777
7777777777777777777777777777777777777777777777CCCCCCCCCCCCCCCCCCCC777777CCCCCCCCCCCCCCCC777777777777777777777777777777777CCCCCCCCCCCCCC7777777777777777777777777
777777777777777777777777777777777777777777777777CCCCCCCCCCCCCCCCC7777777CCCCCCCCCCCCCCCC777777777777777777777777777777777CCCCCCCCCCCCCC7777777777777777777777777
777777777777777777777777777777777777777777777777777CCCCCCCCCCCCC777777777CCCCCCCCCCCCCCCC7777777777777777777777777777777CCCCCCCCCCCCCCC7777777777777777777777777
77777777777777777777777777777777777777777777777777777777CCCCCC77777777777CCCCCCCCCCCCCCCC7777777777777777777777777777777CCCCCCCCCCCCCCC7777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777CCCCCCCCCCCCCCCC77777777777777777777777777777CCCCCCCCCCCCCCCC7777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777CCCCCCCCCCCCCCCC77777777777777777777777777777CCCCCCCCCCCCCCCC7777777777777777777777777
777777777777777777777777777777777777777777777777777777777777777777777777777CCCCCCCCCCCCCCC7777777777777777777777777777CCCCCCCCCCCCCCCC77777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777CCCCCCCCCCCCCCC77777777777777777777777777CCCCCCCCCCCCCCCCC77777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777CCCCCCCCCCCCCCCCCCC777777777777777777777CCCCCCCCCCCCCCCCC777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777CCCCCCCCCCCCCCCCCCCCCCCCC7777777777777CCCCCCCCCCCCCCCCCCC777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777CCCCCCCCCCCCCCCCCCCCCCCCCCCCCC77777CCCCCCCCCCCCCCCCCCCC7777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC77777777777777777777777777777
777777777777777777777777777777777777777777777777777777777777777777777777777777CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC77777777777777777777777777777
777777777777777777777777777777777777777777777777777777777777777777777777777777CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC7777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC7777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC77777777777777777777777777777777
777777777777777777777777777777777777777777777777777777777777777777777777777777777CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC77777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC777777777777777777777777777777777777
777777777777777777777777777777777777777777777777777777777777777777777777777777777777CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC7777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777CCCCCCCCCCCCCCCCCCCCCCCCCCCC7777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777CCCCCCCCCCCCCCCCCCCC777777777777777777777777777777777777777777
77777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777CCCCCCCCCCCC77777777777777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777
7777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777777`)


    screen.setPixelsAt(5, 5, `..3333...3333..
.333333.333333.
333333333333333
333333333333333
333333333333333
333333333333333
.3333333333333.
..33333333333..
...333333333...
....3333333....
.....33333.....
......333......`)
    drawScreen(api, screen.toString())
}
